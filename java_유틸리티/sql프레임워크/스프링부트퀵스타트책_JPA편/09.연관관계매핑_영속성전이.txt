@ManyToOne 와 @OneToMany 의 속성인 casecade 속성으로 영속성 전이 기능을 사용할 수 있다
쉽게 말해 기준 엔티티의 저장,수정, 삭제시 연관된 엔티티도 같이 영향받는 것을 의미한다.
데이터베이스의 casecade 그것과 같은 기능이다.

casecade: 영속성 전이 기능 설정
	CasecadeType.ALL : cascade all operation
	CasecadeType.PERSIST : cascade persist operation
	CasecadeType.MERGE : cascade merge operation
	CasecadeType.REMOVE : cascade remove operation
	CasecadeType.REFRESH : cascade refresh operation
	CasecadeType.DETACH : cascade detach operation

Member는 PK를 가지고 있는 부모 엔티티이며, Board는 FK를 가지고 있는 자식 엔티티로 볼 수 있다.
아래 테스트는 Member 엔티티의 @OneToMany 에 'casecade' 설정으로 
Member 변경시 Board가 영향 받는지 알아보는 테스트이다

------------------- application.properties

# DataSource Setting
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.username=sa
spring.datasource.password=

# JPA Setting
spring.jpa.hibernate.ddl-auto=create # 삽입은 create, 삭제는 update 로 테스트
spring.jpa.generate-ddl=false
spring.jpa.show-sql=true
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.properties.hibernate.format_sql=true

# Logging Setting
logging.level.org.hibernate=info

------------------- board.java

package com.solgae.domain;

import java.time.LocalDateTime;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;
import lombok.Getter;
import lombok.Setter;
import lombok.ToString;

@Getter
@Setter
@ToString(exclude = "member") 
@Entity
public class Board {

	@Id
	@GeneratedValue
	private Long seq;
	private String title;
	
	@ManyToOne // N대1 설정
	@JoinColumn(name="MEMBER_ID", nullable = false) 
	private Member member;
	
	private String content;
	private LocalDateTime createDate;
	private Long cnt;
	
	//override
	public void setMember(Member member) {  
		this.member = member;
		member.getBoardList().add(this);  //<=요기, 영속성 전이를 위해 추가한 코드
	}
}

------------------- member.java

package com.solgae.domain;

import java.util.ArrayList;
import java.util.List;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.FetchType;
import jakarta.persistence.Id;
import jakarta.persistence.OneToMany;
import lombok.Getter;
import lombok.Setter;
import lombok.ToString;

@Getter
@Setter
@ToString(exclude = "boardList")
@Entity
public class Member {

	@Id
	@Column(name ="MEMBER_ID")
	private String id;
	private String password;
	private String name;
	private String role;
	
	
	@OneToMany(mappedBy = "member", fetch = FetchType.EAGER, cascade = CascadeType.ALL) //<= 요기 cascade
	private List<Board> boardList = new ArrayList<Board>(); 
}

------------------- board 리포지토리 생성

package com.solgae.repositary;

import org.springframework.data.querydsl.QuerydslPredicateExecutor;
import org.springframework.data.repository.CrudRepository;

import com.solgae.domain.Board;

public interface DynamicBoardRepositary extends CrudRepository<Board, Long>, QuerydslPredicateExecutor<Board> {

}

------------------- member 리포지토리 생성

package com.solgae.repositary;

import org.springframework.data.repository.CrudRepository;

import com.solgae.domain.Member;

public interface MemberRepositary extends CrudRepository<Member, String> {

}

------------------- 테스트

package com.solgae.mapping;

import java.time.LocalDateTime;
import java.util.List;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import com.solgae.domain.Board;
import com.solgae.domain.Member;
import com.solgae.repositary.DynamicBoardRepositary;
import com.solgae.repositary.MemberRepositary;

@SpringBootTest
public class RelationMappingTest {

	@Autowired
	private DynamicBoardRepositary boardRepositary;
	
	@Autowired
	private MemberRepositary memberRepositary;
	
		
	//영속성 전이 삽입 테스트 , create 상태로 테스트 해야함
	@Test
	public void testCasecadeInsert() {
		
		//member1 영속성 전이
		Member member1 = new Member();
		member1.setId("member1");
		member1.setPassword("member111");
		member1.setName("둘리");
		member1.setRole("User");
				
		for(int i=1; i<=3; i++) {
			Board board = new Board();
			board.setTitle("둘리가 등록한 게시글 "+i);
			board.setMember(member1); //영속성 전이 코드가 오버라이드됨
			board.setContent("둘리가 등록한 게시글 내용 " + i);
			board.setCreateDate(LocalDateTime.now());
			board.setCnt(0L);
			
		}
		memberRepositary.save(member1);
		
	
		// member 2 영속성 전이 삽입
		Member member2 = new Member();
		member2.setId("member2");
		member2.setPassword("member222");
		member2.setName("도우너");
		member2.setRole("Admin");
		
		
		for(int i=1; i<=3; i++) {
			Board board = new Board();
			board.setTitle("도우너가 등록한 게시글 "+i);
			board.setMember(member2); // //영속성 전이 코드가 오버라이드됨
			board.setContent("도우너가 등록한 게시글 내용 " + i);
			board.setCreateDate(LocalDateTime.now());
			board.setCnt(0L);
			
		}
		
		memberRepositary.save(member2);
	}
	
	
	//영속성 전이 삭제 테스트 , update상태로 테스트 해야함
	@Test
	public void testCasecadeDelete() {
		memberRepositary.deleteById("member2"); //board와 member 모두 삭제
	}
}

